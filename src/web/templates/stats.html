{% extends "base.html" %}

{% block title %}Stats - Simkl to Letterboxd{% endblock %}

{% block content %}
<!-- Overview Cards -->
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
    <div class="card p-6">
        <div class="text-4xl font-bold text-white mb-1">{{ stats.total_watched }}</div>
        <div class="text-zinc-500 text-sm">Films Watched</div>
    </div>
    <div class="card p-6">
        <div class="text-4xl font-bold text-zinc-400 mb-1">{{ stats.total_watchlist }}</div>
        <div class="text-zinc-500 text-sm">In Watchlist</div>
    </div>
    <div class="card p-6">
        <div class="text-4xl font-bold text-amber-400 mb-1">{{ stats.average_rating }}</div>
        <div class="text-zinc-500 text-sm">Average Rating</div>
    </div>
    <div class="card p-6">
        {% set rated_count = stats.rating_distribution.values() | sum %}
        <div class="text-4xl font-bold text-emerald-400 mb-1">{{ rated_count }}</div>
        <div class="text-zinc-500 text-sm">Rated Films</div>
    </div>
</div>

<!-- Charts Row -->
<div class="grid lg:grid-cols-2 gap-6 mb-8">
    <!-- Rating Distribution -->
    <div class="card p-6">
        <h2 class="text-sm font-medium text-zinc-400 uppercase tracking-wide mb-5">Rating Distribution</h2>
        <div class="space-y-2">
            {% set max_count = stats.rating_distribution.values() | max if stats.rating_distribution.values() | list else 1 %}
            {% for rating in ['5', '4.5', '4', '3.5', '3', '2.5', '2', '1.5', '1', '0.5'] %}
            {% set count = stats.rating_distribution.get(rating, 0) %}
            {% set percentage = (count / max_count * 100) if max_count > 0 else 0 %}
            <div class="flex items-center gap-3">
                <span class="w-10 text-sm text-amber-400 font-mono">{{ rating }}â˜…</span>
                <div class="flex-1 h-6 bg-zinc-800 rounded overflow-hidden">
                    <div class="h-full bg-amber-500 rounded transition-all duration-500" style="width: {{ percentage }}%"></div>
                </div>
                <span class="w-8 text-sm text-zinc-500 text-right font-mono">{{ count }}</span>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Movies by Month -->
    <div class="card p-6">
        <h2 class="text-sm font-medium text-zinc-400 uppercase tracking-wide mb-5">Films Per Month</h2>
        <div class="flex items-end gap-1 h-52">
            {% set max_month = stats.movies_by_month.values() | max if stats.movies_by_month.values() | list else 1 %}
            {% for month, count in stats.movies_by_month.items() | reverse %}
            {% set height = (count / max_month * 100) if max_month > 0 else 0 %}
            <div class="flex-1 flex flex-col items-center group min-w-0">
                <span class="text-xs text-zinc-400 mb-1 opacity-0 group-hover:opacity-100 transition">{{ count }}</span>
                <div class="w-full bg-blue-500 rounded-t transition-all hover:bg-blue-400" style="height: {{ height }}%"></div>
                <span class="text-xs text-zinc-600 mt-2 truncate w-full text-center" title="{{ month }}">{{ month[-2:] }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Movies by Year -->
<div class="card p-6">
    <h2 class="text-sm font-medium text-zinc-400 uppercase tracking-wide mb-5">Films by Release Year</h2>
    <div class="flex items-end gap-1 h-48 overflow-x-auto pb-2">
        {% set max_year = stats.movies_by_year.values() | max if stats.movies_by_year.values() | list else 1 %}
        {% for year, count in stats.movies_by_year.items() | sort(reverse=true) %}
        {% set height = (count / max_year * 100) if max_year > 0 else 0 %}
        <div class="flex flex-col items-center min-w-[32px] group">
            <span class="text-xs text-zinc-400 mb-1 opacity-0 group-hover:opacity-100 transition">{{ count }}</span>
            <div class="w-5 bg-emerald-500 rounded-t transition-all hover:bg-emerald-400" style="height: {{ height }}%"></div>
            <span class="text-xs text-zinc-600 mt-2">{{ year }}</span>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
